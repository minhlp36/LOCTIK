<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>T√†i kho·∫£n c·ªßa t√¥i - LokTik</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen pb-20">
  <div class="max-w-xl mx-auto p-4">
    <!-- Th√¥ng tin ng∆∞·ªùi d√πng -->
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 class="text-xl font-bold" id="userEmail">Email ng∆∞·ªùi d√πng</h1>
        <p id="userId" class="text-sm text-gray-500">UID:</p>
      </div>
      <button id="logoutBtn" class="bg-red-500 text-white px-4 py-2 rounded">ƒêƒÉng xu·∫•t</button>
    </div>

    <!-- Danh s√°ch b√†i vi·∫øt -->
    <div class="mb-4">
      <h2 class="text-lg font-semibold mb-2">B√†i vi·∫øt c·ªßa t√¥i</h2>
      <div id="myPosts" class="space-y-4"></div>
    </div>
  </div>

  <!-- Thanh ƒëi·ªÅu h∆∞·ªõng -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 flex justify-around py-2">
    <a href="feed.html" class="flex flex-col items-center text-gray-600 hover:text-blue-500">
      <span class="text-xl">üè†</span>
      <span class="text-sm">Feed</span>
    </a>
    <a href="upload.html" class="flex flex-col items-center text-gray-600 hover:text-blue-500">
      <span class="text-xl">‚ûï</span>
      <span class="text-sm">ƒêƒÉng</span>
    </a>
    <a href="account.html" class="flex flex-col items-center text-blue-500 font-bold">
      <span class="text-xl">üë§</span>
      <span class="text-sm">T√†i kho·∫£n</span>
    </a>
  </nav>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getFirestore, collection, query, where, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAJxH_3ZkN7wQnXVelRzm0mezBCBcxKoJM",
      authDomain: "loktik-1d9af.firebaseapp.com",
      projectId: "loktik-1d9af",
      storageBucket: "loktik-1d9af.appspot.com",
      messagingSenderId: "801363229819",
      appId: "1:801363229819:web:49f086bc180d9ed9c0b6de",
      measurementId: "G-S6HQ3HN7W3"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const userEmail = document.getElementById("userEmail");
    const userId = document.getElementById("userId");
    const myPosts = document.getElementById("myPosts");
    const logoutBtn = document.getElementById("logoutBtn");

    // ƒêƒÉng xu·∫•t
    logoutBtn.addEventListener("click", () => {
      signOut(auth).then(() => {
        window.location.href = "login.html";
      });
    });

    // Hi·ªÉn th·ªã b√†i vi·∫øt c√° nh√¢n
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        userEmail.textContent = user.email;
        userId.textContent = "UID: " + user.uid;

        const q = query(collection(db, "posts"), where("uid", "==", user.uid));
        const querySnapshot = await getDocs(q);

        myPosts.innerHTML = "";

        querySnapshot.forEach((docSnap) => {
          const post = docSnap.data();
          const postDiv = document.createElement("div");
          postDiv.className = "bg-white p-4 rounded shadow";

          // Hi·ªÉn th·ªã ·∫£nh n·∫øu c√≥
          if (post.url) {
            const img = document.createElement("img");
            img.src = post.url;
            img.className = "w-full rounded mb-2";
            postDiv.appendChild(img);
          }

          // Hi·ªÉn th·ªã caption n·∫øu c√≥
          if (post.caption) {
            const p = document.createElement("p");
            p.textContent = post.caption;
            p.className = "text-gray-700";
            postDiv.appendChild(p);
          }

          // N√∫t xo√°
          const deleteBtn = document.createElement("button");
          deleteBtn.textContent = "üóëÔ∏è Xo√° b√†i";
          deleteBtn.className = "mt-2 bg-red-500 text-white px-3 py-1 rounded";
          deleteBtn.onclick = async () => {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° b√†i n√†y?")) {
              await deleteDoc(doc(db, "posts", docSnap.id));
              postDiv.remove();
            }
          };

          postDiv.appendChild(deleteBtn);
          myPosts.appendChild(postDiv);
        });
      } else {
        window.location.href = "login.html";
      }
    });
  </script>
</body>
</html>
