<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LokTik - Đăng nhập / Đăng ký</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen px-4">

  <div class="bg-white p-6 rounded-lg shadow-md w-full max-w-sm">
    <h2 id="form-title" class="text-2xl font-bold mb-4 text-center">Đăng nhập LokTik</h2>

    <!-- Đăng nhập -->
    <form id="login-form" class="space-y-4">
      <input type="email" id="login-email" placeholder="Email" class="w-full px-4 py-2 border rounded" required />
      <input type="password" id="login-password" placeholder="Mật khẩu" class="w-full px-4 py-2 border rounded" required />
      <button type="submit" class="w-full bg-blue-500 text-white py-2 rounded hover:bg-blue-600">Đăng nhập</button>
    </form>

    <!-- Đăng ký -->
    <form id="register-form" class="space-y-4 hidden mt-4">
      <input type="text" id="register-name" placeholder="Tên hiển thị" class="w-full px-4 py-2 border rounded" required />
      <input type="email" id="register-email" placeholder="Email" class="w-full px-4 py-2 border rounded" required />
      <input type="password" id="register-password" placeholder="Mật khẩu" class="w-full px-4 py-2 border rounded" required />
      <button type="submit" class="w-full bg-green-500 text-white py-2 rounded hover:bg-green-600">Đăng ký</button>
    </form>

    <!-- Chuyển tab -->
    <div class="text-center mt-4">
      <p>
        <span id="toggle-form" class="text-blue-500 cursor-pointer hover:underline">Chưa có tài khoản? Đăng ký</span>
      </p>
    </div>

    <p id="message" class="text-center mt-4 text-sm text-red-500"></p>
  </div>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAJxH_3ZkN7wQnXVelRzm0mezBCBcxKoJM",
      authDomain: "loktik-1d9af.firebaseapp.com",
      projectId: "loktik-1d9af",
      storageBucket: "loktik-1d9af.appspot.com",
      messagingSenderId: "801363229819",
      appId: "1:801363229819:web:49f086bc180d9ed9c0b6de",
      measurementId: "G-S6HQ3HN7W3"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // DOM elements
    const loginForm = document.getElementById("login-form");
    const registerForm = document.getElementById("register-form");
    const toggle = document.getElementById("toggle-form");
    const message = document.getElementById("message");
    const title = document.getElementById("form-title");

    // Toggle giữa login / register
    toggle.addEventListener("click", () => {
      if (loginForm.classList.contains("hidden")) {
        loginForm.classList.remove("hidden");
        registerForm.classList.add("hidden");
        title.textContent = "Đăng nhập LokTik";
        toggle.textContent = "Chưa có tài khoản? Đăng ký";
      } else {
        loginForm.classList.add("hidden");
        registerForm.classList.remove("hidden");
        title.textContent = "Đăng ký LokTik";
        toggle.textContent = "Đã có tài khoản? Đăng nhập";
      }
      message.textContent = "";
    });

    // Xử lý đăng nhập
    loginForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          window.location.href = "feed.html";
        })
        .catch((error) => {
          message.textContent = "Sai email hoặc mật khẩu.";
        });
    });

    // Xử lý đăng ký và lưu Firestore
    registerForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = document.getElementById("register-name").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;

      auth.createUserWithEmailAndPassword(email, password)
        .then((userCredential) => {
          const user = userCredential.user;
          return user.updateProfile({ displayName: name })
            .then(() => {
              return db.collection("users").doc(user.uid).set({
                uid: user.uid,
                email: user.email,
                displayName: name,
                photoURL: user.photoURL || "",
                createdAt: new Date().toISOString()
              });
            });
        })
        .then(() => {
          message.textContent = "Đăng ký thành công! Hãy đăng nhập.";
          registerForm.reset();
          toggle.click(); // Chuyển sang tab login
        })
        .catch((error) => {
          message.textContent = "Đăng ký thất bại: " + error.message;
        });
    });
  </script>
</body>
</html>
